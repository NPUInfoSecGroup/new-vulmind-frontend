import{d as $,u as T,p as x,c as D,r as m,q as C,b as g,e,m as N,t as y,s as E,g as l,h as d,w as _,l as P,j as w,_ as B,o as F,v as G}from"./index-DvQrrwTy.js";import{M,e as A}from"./MessageView-Bob4CEjK.js";import{_ as R}from"./TerminalView.vue_vue_type_style_index_0_lang-BeNWjGmS.js";import"./index-Dq7h7Pqt.js";const j={class:"header-section"},q={class:"header-content"},U={key:0},z={class:"id"},H={class:"back-button"},J=$({__name:"TaskInfoView",setup(b){const p=T(),a=x().params.taskID,t=D(()=>p.getById(a)),c=m(!1);async function u(){await p.fetchTasks()}u(),C(t,n=>{n?(console.log("当前任务信息:",n),c.value=!0,f()):c.value=!1},{immediate:!0});function f(){console.log("执行后续逻辑")}return(n,i)=>{const s=d("el-button");return w(),g("div",j,[e("div",q,[c.value?(w(),g("h1",U,y(t.value.name),1)):N("",!0),e("p",z,y(E(a)),1)]),e("div",H,[l(s,{type:"primary",onClick:i[0]||(i[0]=o=>n.$router.back())},{default:_(()=>i[1]||(i[1]=[P("返回")])),_:1,__:[1]})])])}}}),K=B(J,[["__scopeId","data-v-8bc56560"]]),L={class:"common-layout"},O={class:"message-card"},Q={class:"header-title"},W={class:"scanner-name"},X={class:"target"},Y={class:"scanner-name"},Z={class:"command"},tt={class:"action"},et={class:"terminal"},st=$({__name:"EnvironmentInfoView",setup(b){const r=x().params.taskID,a=T(),t=m(a.safeGetById(r)),c=m(null),u=m(!1),f=()=>{var v,h,k;const s=((v=t.value)==null?void 0:v.status)==="completed"||((h=t.value)==null?void 0:h.status)==="failed";(k=t.value)!=null&&k.id&&!u.value&&!s&&(u.value=!0,c.value=window.setInterval(async()=>{var I,V;try{await a.fetchTasks();const S=a.safeGetById(r);t.value=S,(((I=t.value)==null?void 0:I.status)==="completed"||((V=t.value)==null?void 0:V.status)==="failed")&&n()}catch(S){console.error("轮询任务状态失败:",S),n()}},5e3))},n=()=>{c.value!==null&&(clearInterval(c.value),c.value=null),u.value=!1};async function i(){var s;if((s=t.value)!=null&&s.id)try{await a.startTask(r),A.emit("startAgent"),f()}catch(o){console.error("启动任务失败:",o)}}return F(()=>{a.fetchTasks().then(()=>{t.value=a.safeGetById(r),f()})}),G(()=>{n()}),C(()=>a.getById(r),s=>{s&&(t.value=s,(s.status==="completed"||s.status==="failed")&&n())},{immediate:!0}),(s,o)=>{const v=d("el-button"),h=d("el-aside"),k=d("el-main"),I=d("el-container");return w(),g("div",L,[l(I,null,{default:_(()=>[l(h,{width:"50%",class:"aside"},{default:_(()=>[o[1]||(o[1]=e("h2",null,"环境信息",-1)),e("div",O,[e("div",Q,[e("span",W,[e("span",X,y(t.value&&t.value.target),1)]),e("span",Y,[e("span",Z,y(t.value&&t.value.command),1)])]),e("div",tt,[l(v,{type:"primary",onClick:i},{default:_(()=>o[0]||(o[0]=[P(" 执行任务 ")])),_:1,__:[0]})])]),e("div",et,[l(R)])]),_:1,__:[1]}),l(k,null,{default:_(()=>[o[2]||(o[2]=e("h2",null,"扫描过程",-1)),l(M)]),_:1,__:[2]})]),_:1})])}}}),at=B(st,[["__scopeId","data-v-6eca9054"]]),ot={class:"report-template-view"},nt=$({__name:"ScannerPage",setup(b){return m("first"),(p,r)=>(w(),g("div",ot,[l(K),l(at)]))}}),dt=B(nt,[["__scopeId","data-v-1a0f5315"]]);export{dt as default};
