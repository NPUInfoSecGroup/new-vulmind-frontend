import{d as $,u as E,r as C,o as F,a as z,c as I,b as o,e,f as y,g as l,w as d,h as r,E as D,i as j,j as a,F as P,k as W,t as p,l as S,m,n as q,_ as A}from"./index-_3AGFK03.js";const G={class:"scan-history-view"},J={class:"filter-card"},K={class:"filter-item"},O={class:"filter-item"},Q={class:"filter-item"},X={class:"scanner-header"},Z={class:"name"},w={class:"scanner-name"},tt={class:"date-info"},et={class:"date"},st={key:0,class:"info-item pending"},lt={key:1,class:"info-item running"},at={key:2,class:"info-item completed"},nt={key:3,class:"info-item failed"},it={class:"card-body"},ot={class:"target-info"},dt={class:"target"},ut={class:"vuln-summary"},ct={key:0,class:"vuln-item critical"},rt={class:"vuln-count"},mt={key:1,class:"vuln-item high"},pt={class:"vuln-count"},_t={key:2,class:"vuln-item medium"},ft={class:"vuln-count"},vt={key:3,class:"vuln-item low"},gt={class:"vuln-count"},yt={key:4,class:"vuln-item low"},ht={key:5,class:"vuln-item critical"},bt={class:"card-footer action-buttons"},kt=$({__name:"ScanHistory",setup(Vt){const h=E(),T=j(),v=C([]),b=C(!0),R=async()=>{await h.fetchTasks()},H=async()=>{b.value=!0;try{await R(),v.value=h.getScanHistory().slice().reverse(),v.value.length===0?D.info("暂无扫描历史记录"):console.log("获取的扫描历史数量:",v.value.length)}catch(c){D.error("加载扫描历史失败，请稍后重试"),console.error("加载扫描历史失败:",c)}finally{b.value=!1}};F(()=>{H()});const u=z({target:"",dateRange:[],status:""}),k=I(()=>{const c=v.value??[],t=u.dateRange??[];return c.filter(n=>{const f=u.target?n.target.toLowerCase().includes(u.target.toLowerCase()):!0,g=t.length===2?new Date(n.startTime)>=new Date(t[0])&&new Date(n.startTime)<=new Date(t[1]):!0,_=u.status?n.status===u.status:!0;return f&&g&&_})}),i=c=>{const t=(c==null?void 0:c.results)||[];return{critical:t.filter(n=>n.severity==="critical").length,high:t.filter(n=>n.severity==="high").length,medium:t.filter(n=>n.severity==="medium").length,low:t.filter(n=>n.severity==="low").length}},B=c=>{T.push("/scan-history/"+c.id)};return(c,t)=>{const n=r("el-input"),f=r("el-col"),g=r("el-date-picker"),_=r("el-option"),L=r("el-select"),V=r("el-row"),M=r("el-tag"),N=r("el-button"),U=r("el-card"),Y=r("el-empty");return a(),o("div",G,[t[19]||(t[19]=e("div",{class:"header-section"},[e("div",{class:"header-content"},[e("div",{class:"title-container"},[e("h1",null,"扫描历史记录")]),e("p",{class:"subtitle"},"查看和管理扫描历史记录，分析漏洞技术细节")])],-1)),e("div",J,[l(V,{gutter:20},{default:d(()=>[l(f,{xs:24,sm:12,md:8},{default:d(()=>[e("div",K,[t[4]||(t[4]=e("label",{class:"filter-label"},"扫描目标",-1)),l(n,{modelValue:u.target,"onUpdate:modelValue":t[0]||(t[0]=s=>u.target=s),placeholder:"输入URL或关键词",class:"filter-input"},{prefix:d(()=>t[3]||(t[3]=[e("i",{class:"fas fa-bullseye"},null,-1)])),_:1},8,["modelValue"])])]),_:1}),l(f,{xs:24,sm:12,md:8},{default:d(()=>[e("div",O,[t[6]||(t[6]=e("label",{class:"filter-label"},"日期范围",-1)),l(g,{modelValue:u.dateRange,"onUpdate:modelValue":t[1]||(t[1]=s=>u.dateRange=s),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",class:"filter-date-picker"},{prefix:d(()=>t[5]||(t[5]=[e("i",{class:"fas fa-calendar"},null,-1)])),_:1},8,["modelValue"])])]),_:1}),l(f,{xs:24,sm:12,md:8},{default:d(()=>[e("div",Q,[t[7]||(t[7]=e("label",{class:"filter-label"},"状态",-1)),l(L,{modelValue:u.status,"onUpdate:modelValue":t[2]||(t[2]=s=>u.status=s),placeholder:"选择状态",class:"filter-select"},{default:d(()=>[l(_,{label:"全部",value:""}),l(_,{label:"挂起",value:"pending"}),l(_,{label:"执行",value:"running"}),l(_,{label:"完成",value:"completed"}),l(_,{label:"失败",value:"failed"})]),_:1},8,["modelValue"])])]),_:1})]),_:1})]),k.value.length>0?(a(),y(V,{key:0,gutter:20,class:"scan-history-cards"},{default:d(()=>[(a(!0),o(P,null,W(k.value,(s,x)=>(a(),y(f,{key:x,xs:24,sm:24,md:12,lg:12,xl:8},{default:d(()=>[l(U,{class:"scan-history-card",shadow:"hover"},{default:d(()=>[e("div",X,[e("div",Z,[e("span",w,p(s.name||`扫描记录 ${x+1}`),1),l(M,{type:/^(?:\d{1,3}\.){3}\d{1,3}$/.test(s.target)?"warning":"primary",class:"scan-type-tag",effect:"plain"},{default:d(()=>[S(p(/^(?:\d{1,3}\.){3}\d{1,3}$/.test(s.target)?"IP扫描":"Web扫描"),1)]),_:2},1032,["type"])]),e("div",tt,[e("div",et,p(s.startTime),1),s.status=="pending"?(a(),o("div",st,t[8]||(t[8]=[e("p",null,"挂起",-1)]))):m("",!0),s.status=="running"?(a(),o("div",lt,t[9]||(t[9]=[e("p",null,"执行",-1)]))):m("",!0),s.status=="completed"?(a(),o("div",at,t[10]||(t[10]=[e("p",null,"完成",-1)]))):m("",!0),s.status=="failed"?(a(),o("div",nt,t[11]||(t[11]=[e("p",null,"失败",-1)]))):m("",!0)])]),e("div",it,[e("div",ot,[e("i",{class:q(["fas",s.type==="web"?"fa-globe":"fa-file-code"])},null,2),e("span",dt,p(s.target),1)]),e("div",ut,[i(s).critical>0&&s.status!=="failed"?(a(),o("div",ct,[t[12]||(t[12]=e("span",{class:"vuln-label"},"严重",-1)),e("span",rt,p(i(s).critical),1)])):m("",!0),i(s).high>0&&s.status!=="failed"?(a(),o("div",mt,[t[13]||(t[13]=e("span",{class:"vuln-label"},"高危",-1)),e("span",pt,p(i(s).high),1)])):m("",!0),i(s).medium>0&&s.status!=="failed"?(a(),o("div",_t,[t[14]||(t[14]=e("span",{class:"vuln-label"},"中危",-1)),e("span",ft,p(i(s).medium),1)])):m("",!0),i(s).low>0&&s.status!=="failed"?(a(),o("div",vt,[t[15]||(t[15]=e("span",{class:"vuln-label"},"低危",-1)),e("span",gt,p(i(s).low),1)])):m("",!0),i(s).low===0&&i(s).medium===0&&i(s).high===0&&i(s).critical===0&&s.status!=="failed"?(a(),o("div",yt,t[16]||(t[16]=[e("span",{class:"vuln-label"},"待分析",-1)]))):m("",!0),s.status==="failed"?(a(),o("div",ht,t[17]||(t[17]=[e("span",{class:"vuln-label"},"扫描异常",-1)]))):m("",!0)])]),e("div",bt,[l(N,{type:"primary",onClick:xt=>B(s),class:"gobutton"},{default:d(()=>t[18]||(t[18]=[e("i",{class:"fas fa-search"},null,-1),S(" 查看详情 ")])),_:2,__:[18]},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(a(),y(Y,{key:1,description:"暂无扫描记录","image-size":160,class:"empty-placeholder"}))])}}}),Dt=A(kt,[["__scopeId","data-v-c52f0c70"]]);export{Dt as default};
