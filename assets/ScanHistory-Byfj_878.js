import{d as $,u as E,r as C,o as F,a as z,c as I,b as r,e as t,f as y,g as l,w as i,h as u,E as D,i as j,j as n,F as P,k as W,t as p,l as S,m,n as q,_ as A}from"./index-DybniX-D.js";const G={class:"scan-history-view"},J={class:"filter-card"},K={class:"filter-item"},O={class:"filter-item"},Q={class:"filter-item"},X={class:"scanner-header"},Z={class:"name"},w={class:"scanner-name"},ee={class:"date-info"},te={class:"date"},se={key:0,class:"info-item pending"},le={key:1,class:"info-item running"},ae={key:2,class:"info-item completed"},ne={key:3,class:"info-item failed"},oe={class:"card-body"},ie={class:"target-info"},de={class:"target"},re={class:"vuln-summary"},ce={key:0,class:"vuln-item critical"},ue={class:"vuln-count"},me={key:1,class:"vuln-item high"},pe={class:"vuln-count"},_e={key:2,class:"vuln-item medium"},ve={class:"vuln-count"},fe={key:3,class:"vuln-item low"},ge={class:"vuln-count"},ye={key:4,class:"vuln-item safe"},he={class:"card-footer action-buttons"},be=$({__name:"ScanHistory",setup(ke){const h=E(),T=j(),f=C([]),b=C(!0),R=async()=>{await h.fetchTasks()},H=async()=>{b.value=!0;try{await R(),f.value=h.getScanHistory().slice().reverse(),f.value.length===0?D.info("暂无扫描历史记录"):console.log("获取的扫描历史数量:",f.value.length)}catch(c){D.error("加载扫描历史失败，请稍后重试"),console.error("加载扫描历史失败:",c)}finally{b.value=!1}};F(()=>{H()});const d=z({target:"",dateRange:[],status:""}),k=I(()=>{const c=f.value??[],e=d.dateRange??[];return c.filter(a=>{const v=d.target?a.target.toLowerCase().includes(d.target.toLowerCase()):!0,g=e.length===2?new Date(a.startTime)>=new Date(e[0])&&new Date(a.startTime)<=new Date(e[1]):!0,_=d.status?a.status===d.status:!0;return v&&g&&_})}),o=c=>{const e=(c==null?void 0:c.results)||[];return{critical:e.filter(a=>a.severity==="critical").length,high:e.filter(a=>a.severity==="high").length,medium:e.filter(a=>a.severity==="medium").length,low:e.filter(a=>a.severity==="low").length}},B=c=>{T.push("/scan-history/"+c.id)};return(c,e)=>{const a=u("el-input"),v=u("el-col"),g=u("el-date-picker"),_=u("el-option"),L=u("el-select"),V=u("el-row"),M=u("el-tag"),N=u("el-button"),U=u("el-card"),Y=u("el-empty");return n(),r("div",G,[e[18]||(e[18]=t("div",{class:"header-section"},[t("div",{class:"header-content"},[t("div",{class:"title-container"},[t("h1",null,"扫描历史记录")]),t("p",{class:"subtitle"},"查看和管理扫描历史记录，分析漏洞技术细节")])],-1)),t("div",J,[l(V,{gutter:20},{default:i(()=>[l(v,{xs:24,sm:12,md:8},{default:i(()=>[t("div",K,[e[4]||(e[4]=t("label",{class:"filter-label"},"扫描目标",-1)),l(a,{modelValue:d.target,"onUpdate:modelValue":e[0]||(e[0]=s=>d.target=s),placeholder:"输入URL或关键词",class:"filter-input"},{prefix:i(()=>e[3]||(e[3]=[t("i",{class:"fas fa-bullseye"},null,-1)])),_:1},8,["modelValue"])])]),_:1}),l(v,{xs:24,sm:12,md:8},{default:i(()=>[t("div",O,[e[6]||(e[6]=t("label",{class:"filter-label"},"日期范围",-1)),l(g,{modelValue:d.dateRange,"onUpdate:modelValue":e[1]||(e[1]=s=>d.dateRange=s),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",class:"filter-date-picker"},{prefix:i(()=>e[5]||(e[5]=[t("i",{class:"fas fa-calendar"},null,-1)])),_:1},8,["modelValue"])])]),_:1}),l(v,{xs:24,sm:12,md:8},{default:i(()=>[t("div",Q,[e[7]||(e[7]=t("label",{class:"filter-label"},"状态",-1)),l(L,{modelValue:d.status,"onUpdate:modelValue":e[2]||(e[2]=s=>d.status=s),placeholder:"选择状态",class:"filter-select"},{default:i(()=>[l(_,{label:"全部",value:""}),l(_,{label:"挂起",value:"pending"}),l(_,{label:"执行",value:"running"}),l(_,{label:"完成",value:"completed"}),l(_,{label:"失败",value:"failed"})]),_:1},8,["modelValue"])])]),_:1})]),_:1})]),k.value.length>0?(n(),y(V,{key:0,gutter:20,class:"scan-history-cards"},{default:i(()=>[(n(!0),r(P,null,W(k.value,(s,x)=>(n(),y(v,{key:x,xs:24,sm:24,md:12,lg:12,xl:8},{default:i(()=>[l(U,{class:"scan-history-card",shadow:"hover"},{default:i(()=>[t("div",X,[t("div",Z,[t("span",w,p(s.name||`扫描记录 ${x+1}`),1),l(M,{type:/^(?:\d{1,3}\.){3}\d{1,3}$/.test(s.target)?"warning":"primary",class:"scan-type-tag",effect:"plain"},{default:i(()=>[S(p(/^(?:\d{1,3}\.){3}\d{1,3}$/.test(s.target)?"IP扫描":"Web扫描"),1)]),_:2},1032,["type"])]),t("div",ee,[t("div",te,p(s.startTime),1),s.status=="pending"?(n(),r("div",se,e[8]||(e[8]=[t("p",null,"挂起",-1)]))):m("",!0),s.status=="running"?(n(),r("div",le,e[9]||(e[9]=[t("p",null,"执行",-1)]))):m("",!0),s.status=="completed"?(n(),r("div",ae,e[10]||(e[10]=[t("p",null,"完成",-1)]))):m("",!0),s.status=="failed"?(n(),r("div",ne,e[11]||(e[11]=[t("p",null,"失败",-1)]))):m("",!0)])]),t("div",oe,[t("div",ie,[t("i",{class:q(["fas",s.type==="web"?"fa-globe":"fa-file-code"])},null,2),t("span",de,p(s.target),1)]),t("div",re,[o(s).critical>0?(n(),r("div",ce,[e[12]||(e[12]=t("span",{class:"vuln-label"},"严重",-1)),t("span",ue,p(o(s).critical),1)])):m("",!0),o(s).high>0?(n(),r("div",me,[e[13]||(e[13]=t("span",{class:"vuln-label"},"高危",-1)),t("span",pe,p(o(s).high),1)])):m("",!0),o(s).medium>0?(n(),r("div",_e,[e[14]||(e[14]=t("span",{class:"vuln-label"},"中危",-1)),t("span",ve,p(o(s).medium),1)])):m("",!0),o(s).low>0?(n(),r("div",fe,[e[15]||(e[15]=t("span",{class:"vuln-label"},"低危",-1)),t("span",ge,p(o(s).low),1)])):m("",!0),o(s).low===0&&o(s).medium===0&&o(s).high===0&&o(s).critical===0?(n(),r("div",ye,e[16]||(e[16]=[t("span",{class:"vuln-label"},"无风险",-1)]))):m("",!0)])]),t("div",he,[l(N,{type:"primary",onClick:Ve=>B(s),class:"gobutton"},{default:i(()=>e[17]||(e[17]=[t("i",{class:"fas fa-search"},null,-1),S(" 查看详情 ")])),_:2,__:[17]},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(n(),y(Y,{key:1,description:"暂无扫描记录","image-size":160,class:"empty-placeholder"}))])}}}),Ce=A(be,[["__scopeId","data-v-cc8b57ac"]]);export{Ce as default};
