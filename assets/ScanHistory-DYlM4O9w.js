import{_ as q,c as d,a as B,b as e,d as n,w as i,r,e as b,o as E,f as P,g as N,E as F,h as c,i as v,t as o,n as D,j as f,k as M,F as Y,l as I}from"./index-BO4Ry953.js";const O={setup(){const S=b([]),t=b(!0),T=()=>{try{t.value=!0;const s=require.context("@/scan-details",!1,/^\.\/scan-\d{10}\.json$/);S.value=s.keys().map(_=>s(_)).sort((_,h)=>h.id.localeCompare(_.id))}catch(s){console.error(s),F.error("加载扫描记录失败")}finally{t.value=!1}};E(()=>{T()});const a=P({target:"",dateRange:[],status:""}),m=b(1),w=b(5),V=N(()=>S.value.length),p=N(()=>S.value.filter(s=>{const _=a.target?s.target.toLowerCase().includes(a.target.toLowerCase()):!0,h=a.dateRange.length===2?s.date>=a.dateRange[0]&&s.date<=a.dateRange[1]:!0,k=a.status?s.status===a.status:!0;return _&&h&&k}).slice((m.value-1)*w.value,m.value*w.value)),R=()=>{m.value=1},g=()=>{a.target="",a.dateRange=[],a.status="",m.value=1},x=s=>{m.value=s},u=b(!1),C=b(null);return{filterForm:a,filteredHistory:p,totalItems:V,pageSize:w,currentPage:m,searchHistory:R,resetFilter:g,handlePageChange:x,viewTechnicalDetails:s=>{C.value={...s},u.value=!0},generateReport:s=>{F.success(`正在生成 ${s.target} 的扫描报告...`)},handleRowClick:s=>{console.log("点击行:",s.id)},detailDialogVisible:u,currentScan:C,getSeverityTagType:s=>{switch(s){case"critical":return"danger";case"high":return"warning";case"medium":return"primary";case"low":return"success";default:return"info"}},getSeverityLabel:s=>{switch(s){case"critical":return"严重";case"high":return"高危";case"medium":return"中危";case"low":return"低危";default:return"未知"}},getSeverityLevel:s=>{switch(s){case"critical":return"极高风险";case"high":return"高风险";case"medium":return"中等风险";case"low":return"低风险";default:return"未知风险"}},loading:t,exportVulnerability:s=>{const _=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),h=URL.createObjectURL(_),k=document.createElement("a");k.href=h,k.download=`${s.id}.json`,k.click(),URL.revokeObjectURL(h),F.success(`${s.id} 已导出`)}}}},J={class:"scan-history-view"},W={class:"filter-card"},A={class:"filter-section"},G={class:"filter-row"},K={class:"filter-row"},Q={class:"history-card"},X={class:"history-list"},Z={class:"date-container"},$={class:"date-value"},ee={class:"time-value"},te={class:"target-container"},le={class:"vuln-summary"},ae={key:0,class:"vuln-item critical"},se={class:"vuln-count"},ne={key:1,class:"vuln-item high"},ie={class:"vuln-count"},oe={key:2,class:"vuln-item medium"},re={class:"vuln-count"},de={key:3,class:"vuln-item low"},ce={class:"vuln-count"},ue={class:"action-buttons"},ve={class:"pagination-section"},me={key:0,class:"tech-detail-container"},_e={class:"vulnerability-section"},fe={class:"section-title"},pe={class:"vuln-count"},ge={class:"vuln-list"},ye={class:"vuln-header"},he={class:"vuln-title"},be={class:"vuln-id"},ke={class:"vuln-name"},Se={class:"vuln-actions"},we={class:"vuln-content"},Ce={class:"vuln-description"},Ve={class:"vuln-info-grid"},Re={class:"info-item"},xe={class:"info-item"},Le={key:0,class:"vuln-location"},Fe={key:1,class:"vuln-request"},De={class:"dialog-footer"};function Te(S,t,T,a,m,w){const V=r("el-input"),p=r("el-form-item"),R=r("el-date-picker"),g=r("el-option"),x=r("el-select"),u=r("el-button"),C=r("el-form"),y=r("el-table-column"),L=r("el-tag"),z=r("el-table"),U=r("el-pagination"),j=r("el-tooltip"),H=r("el-dialog");return c(),d("div",J,[t[24]||(t[24]=B('<div class="header-section" data-v-2d202211><div class="header-content" data-v-2d202211><div class="title-container" data-v-2d202211><i class="fas fa-history" data-v-2d202211></i><h1 data-v-2d202211>扫描历史记录</h1></div><p class="subtitle" data-v-2d202211>查看和管理扫描历史记录，分析漏洞技术细节</p></div><div class="header-decoration" data-v-2d202211><div class="decoration-item" data-v-2d202211></div><div class="decoration-item" data-v-2d202211></div><div class="decoration-item" data-v-2d202211></div></div></div>',1)),e("div",W,[e("div",A,[n(C,{inline:!0,model:a.filterForm},{default:i(()=>[e("div",G,[n(p,{label:"扫描目标"},{default:i(()=>[n(V,{modelValue:a.filterForm.target,"onUpdate:modelValue":t[0]||(t[0]=l=>a.filterForm.target=l),placeholder:"输入URL或关键词",class:"filter-input"},{prefix:i(()=>t[5]||(t[5]=[e("i",{class:"fas fa-bullseye"},null,-1)])),_:1},8,["modelValue"])]),_:1}),n(p,{label:"日期范围"},{default:i(()=>[n(R,{modelValue:a.filterForm.dateRange,"onUpdate:modelValue":t[1]||(t[1]=l=>a.filterForm.dateRange=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",class:"filter-date-picker"},{prefix:i(()=>t[6]||(t[6]=[e("i",{class:"fas fa-calendar"},null,-1)])),_:1},8,["modelValue"])]),_:1})]),e("div",K,[n(p,{label:"状态"},{default:i(()=>[n(x,{modelValue:a.filterForm.status,"onUpdate:modelValue":t[2]||(t[2]=l=>a.filterForm.status=l),placeholder:"选择状态",class:"filter-select"},{default:i(()=>[n(g,{label:"全部",value:""}),n(g,{label:"已完成",value:"completed"}),n(g,{label:"失败",value:"failed"}),n(g,{label:"进行中",value:"scanning"})]),_:1},8,["modelValue"])]),_:1}),n(p,null,{default:i(()=>[n(u,{type:"primary",onClick:a.searchHistory,class:"filter-button primary"},{default:i(()=>t[7]||(t[7]=[e("i",{class:"fas fa-search"},null,-1),v(" 搜索 ")])),_:1,__:[7]},8,["onClick"]),n(u,{onClick:a.resetFilter,class:"filter-button secondary"},{default:i(()=>t[8]||(t[8]=[e("i",{class:"fas fa-undo"},null,-1),v(" 重置 ")])),_:1,__:[8]},8,["onClick"])]),_:1})])]),_:1},8,["model"])])]),e("div",Q,[e("div",X,[n(z,{data:a.filteredHistory,style:{width:"100%"},class:"scan-history-table","row-class-name":"scan-row","header-row-class-name":"header-row",onRowClick:a.handleRowClick},{default:i(()=>[n(y,{prop:"date",label:"扫描日期",width:"180"},{default:i(({row:l})=>[e("div",Z,[e("div",$,o(l.date),1),e("div",ee,o(l.time),1)])]),_:1}),n(y,{prop:"target",label:"扫描目标"},{default:i(({row:l})=>[e("div",te,[e("i",{class:D(["fas",l.type==="web"?"fa-globe":"fa-file-code"])},null,2),e("span",null,o(l.target),1)])]),_:1}),n(y,{prop:"type",label:"扫描类型",width:"120"},{default:i(({row:l})=>[n(L,{type:l.type==="web"?"success":"info",class:"scan-type-tag",effect:"dark",round:""},{default:i(()=>[v(o(l.type==="web"?"Web扫描":"二进制扫描"),1)]),_:2},1032,["type"])]),_:1}),n(y,{label:"结果概要",width:"180"},{default:i(({row:l})=>[e("div",le,[l.vulnSummary.critical>0?(c(),d("div",ae,[e("span",se,o(l.vulnSummary.critical),1),t[9]||(t[9]=e("span",{class:"vuln-label"},"严重",-1))])):f("",!0),l.vulnSummary.high>0?(c(),d("div",ne,[e("span",ie,o(l.vulnSummary.high),1),t[10]||(t[10]=e("span",{class:"vuln-label"},"高危",-1))])):f("",!0),l.vulnSummary.medium>0?(c(),d("div",oe,[e("span",re,o(l.vulnSummary.medium),1),t[11]||(t[11]=e("span",{class:"vuln-label"},"中危",-1))])):f("",!0),l.vulnSummary.low>0?(c(),d("div",de,[e("span",ce,o(l.vulnSummary.low),1),t[12]||(t[12]=e("span",{class:"vuln-label"},"低危",-1))])):f("",!0)])]),_:1}),n(y,{label:"操作",width:"240",fixed:"right"},{default:i(({row:l})=>[e("div",ue,[n(u,{size:"small",class:"action-button tech-details",onClick:M(s=>a.viewTechnicalDetails(l),["stop"])},{default:i(()=>t[13]||(t[13]=[e("i",{class:"fas fa-search"},null,-1),v(" 技术细节 ")])),_:2,__:[13]},1032,["onClick"]),n(u,{size:"small",type:"primary",class:"action-button generate-report",onClick:M(s=>a.generateReport(l),["stop"])},{default:i(()=>t[14]||(t[14]=[e("i",{class:"fas fa-file-pdf"},null,-1),v(" 生成报告 ")])),_:2,__:[14]},1032,["onClick"])])]),_:1})]),_:1},8,["data","onRowClick"]),e("div",ve,[n(U,{background:"",layout:"prev, pager, next, jumper",total:a.totalItems,"page-size":a.pageSize,"current-page":a.currentPage,onCurrentChange:a.handlePageChange,class:"history-pagination"},null,8,["total","page-size","current-page","onCurrentChange"])])])]),n(H,{modelValue:a.detailDialogVisible,"onUpdate:modelValue":t[4]||(t[4]=l=>a.detailDialogVisible=l),title:`扫描技术细节 - ${a.currentScan?a.currentScan.target:""}`,width:"85%",top:"5vh","custom-class":"tech-detail-dialog"},{footer:i(()=>[e("div",De,[n(u,{onClick:t[3]||(t[3]=l=>a.detailDialogVisible=!1)},{default:i(()=>t[23]||(t[23]=[v("关闭")])),_:1,__:[23]})])]),default:i(()=>[a.currentScan?(c(),d("div",me,[e("div",_e,[e("h3",fe,[t[15]||(t[15]=e("i",{class:"fas fa-bug"},null,-1)),t[16]||(t[16]=v(" 漏洞列表 ")),e("span",pe,"(共 "+o(a.currentScan.vulnerabilities.length)+" 个漏洞)",1)]),e("div",ge,[(c(!0),d(Y,null,I(a.currentScan.vulnerabilities,l=>(c(),d("div",{key:l.id,class:D(["vuln-item",l.severity])},[e("div",ye,[e("div",he,[e("span",be,o(l.id),1),e("span",ke,o(l.name),1),n(L,{type:a.getSeverityTagType(l.severity),size:"small",effect:"dark",class:"severity-tag"},{default:i(()=>[v(o(a.getSeverityLabel(l.severity)),1)]),_:2},1032,["type"])]),e("div",Se,[n(j,{effect:"dark",content:"导出详情",placement:"top"},{default:i(()=>[n(u,{circle:"",size:"small",onClick:s=>a.exportVulnerability(l)},{default:i(()=>t[17]||(t[17]=[e("i",{class:"fas fa-download"},null,-1)])),_:2,__:[17]},1032,["onClick"])]),_:2},1024)])]),e("div",we,[e("div",Ce,[t[18]||(t[18]=e("label",null,"详细描述:",-1)),e("p",null,o(l.description),1)]),e("div",Ve,[e("div",Re,[t[19]||(t[19]=e("label",null,"风险等级:",-1)),e("span",{class:D("risk-level "+l.severity)},o(a.getSeverityLevel(l.severity)),3)]),e("div",xe,[t[20]||(t[20]=e("label",null,"发现时间:",-1)),e("span",null,o(a.currentScan.time),1)])]),l.location?(c(),d("div",Le,[t[21]||(t[21]=e("label",null,"漏洞位置:",-1)),e("pre",null,o(l.location),1)])):f("",!0),l.request?(c(),d("div",Fe,[t[22]||(t[22]=e("label",null,"请求示例:",-1)),e("pre",null,o(l.request),1)])):f("",!0)])],2))),128))])])])):f("",!0)]),_:1},8,["modelValue","title"])])}const Ue=q(O,[["render",Te],["__scopeId","data-v-2d202211"]]);export{Ue as default};
