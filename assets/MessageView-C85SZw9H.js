import{C as m,d as f,p as _,o as v,c as w,b as d,g as y,w as b,h as k,e as n,F as C,k as M,j as p,t as g,_ as S}from"./index-C9SCK9Rp.js";const h="http://localhost:3000",T=m("chat",{state:()=>({convs:[]}),getters:{getMessages:e=>t=>{const s=e.convs.find(o=>o.taskId===t);return s?s.messages:[]}},actions:{async sendMessage(e,t){try{const o=await(await fetch(`${h}/api/tasks/${e}/messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();this._appendMsg(e,o)}catch(s){console.error(s)}},async streamReceive(e,t){const s=await fetch(`${h}/tasks/${e}/stream`,{method:"GET",headers:{Accept:"text/plain"}});if(!s.body)return;const o=s.body.getReader(),r=new TextDecoder;for(;;){const{done:u,value:c}=await o.read();if(u)break;const i=r.decode(c,{stream:!0});for(const a of i){const l={role:"assistant",content:a,timestamp:new Date().toISOString()};this._appendMsg(e,l),t(l)}}},async fetchAllConversations(){try{const e=await fetch(`${h}/conversations`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();this.convs=t}catch(e){console.error("æ‹‰å–æ‰€æœ‰å¯¹è¯è®°å½•å¤±è´¥:",e)}},_appendMsg(e,t){let s=this.convs.find(o=>o.taskId===e);s||(s={taskId:e,messages:[]},this.convs.push(s)),s.messages.push(t)}}}),$={class:"scanner-box"},x={class:"message"},A=f({__name:"MessageView",setup(e){const s=_().params.taskID;v(()=>{o.fetchAllConversations()}),console.log(`å½“å‰ä»»åŠ¡ ID: ${s}`);const o=T(),r=w(()=>o.getMessages(s));return console.log(`å½“å‰ä»»åŠ¡ ${s} çš„æ¶ˆæ¯`,r.value),(u,c)=>{const i=k("el-scrollbar");return p(),d("div",$,[y(i,{ref:"scrollbarRef",class:"chat-panel"},{default:b(()=>[n("div",x,[(p(!0),d(C,null,M(r.value,(a,l)=>(p(),d("div",{key:l},[n("p",null,[n("strong",null,g(a.role==="user"?"ðŸ‘¤ ä½ ":a.role==="assistant"?"ðŸ¤– AI":"ðŸ“¢ ç³»ç»Ÿ")+"ï¼š",1)]),n("p",null,g(a.content),1),c[0]||(c[0]=n("hr",null,null,-1))]))),128))])]),_:1},512)])}}}),I=S(A,[["__scopeId","data-v-820119ab"]]);export{I as default};
