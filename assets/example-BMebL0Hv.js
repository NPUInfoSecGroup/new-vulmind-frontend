import{D as F,m as E,o as L,r as C,c as v,b as i,d as e,G as N,k as p,z as f,A as T,t as d,F as y,j as _,i as u,n as w,l as m,_ as R}from"./index-BtKFwgDY.js";const h="http://localhost:3000",A=F("task",{state:()=>({tasks:[]}),getters:{getById:a=>t=>a.tasks.find(o=>o.id===t),pendingTasks:a=>a.tasks.filter(t=>t.status==="pending"),runningTasks:a=>a.tasks.filter(t=>t.status==="running"),completedTasks:a=>a.tasks.filter(t=>t.status==="completed"),failedTasks:a=>a.tasks.filter(t=>t.status==="failed")},actions:{async fetchTasks(){try{console.log("Fetching tasks from backend...");const t=await(await fetch(`${h}/tasks`)).json();this.tasks=t}catch(a){console.error("fetchTasks error:",a)}},async addTask(a){try{console.log("Adding task:",a);const o=await(await fetch(`${h}/tasks`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...a,results:[]})})).json();this.tasks.push(o)}catch(t){console.error("addTask error:",t)}},async updateTask(a,t){try{const k=await(await fetch(`${h}/tasks/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json(),c=this.tasks.findIndex(g=>g.id===a);c!==-1&&this.tasks.splice(c,1,k)}catch(o){console.error("updateTask error:",o)}},async removeTask(a){try{await fetch(`${h}/tasks/${a}`,{method:"DELETE"}),this.tasks=this.tasks.filter(t=>t.id!==a)}catch(t){console.error("removeTask error:",t)}},addResult(a,t){const o=this.getById(a);o&&o.results.push(t)}}}),O={class:"task-manager"},U={class:"task-creator"},q={class:"task-list"},P={class:"status-tabs"},z=["onClick"],J={key:0},G={class:"task-header"},Q={class:"status-badge"},X=["onClick"],H={class:"task-actions"},K=["onClick"],W=["onClick"],Y=["onClick"],Z=["onClick"],tt={key:0,class:"results-container"},st={class:"severity-tag"},et={key:1},nt=E({__name:"example",setup(a){const t=A();L(()=>{t.fetchTasks()});const o=C({name:"",target:"",command:""}),k=C("all"),c=v(()=>t.tasks),g=v(()=>k.value==="all"?c.value:c.value.filter(l=>l.status===k.value)),b=v(()=>({all:c.value.length,pending:t.pendingTasks.length,running:t.runningTasks.length,completed:t.completedTasks.length,failed:t.failedTasks.length})),S=l=>new Date(l).toLocaleString(),$=async()=>{await t.fetchTasks()},x=async()=>{await t.addTask({...o.value,status:"pending"}),o.value={name:"",target:"",command:""}},D=async l=>{await t.updateTask(l,{status:"running",startTime:new Date().toISOString()})},I=async l=>{await t.updateTask(l,{status:"completed"})},M=async l=>{await t.updateTask(l,{status:"failed"})},V=async l=>{confirm("确定要删除此任务吗？")&&await t.removeTask(l)},j=l=>{const n=["low","medium","high","critical"],s=["SQL 注入","XSS 跨站脚本","CSRF 跨站请求伪造","命令注入","路径遍历","SSRF 服务端请求伪造"],r=Math.floor(Math.random()*s.length);t.addResult(l,{resultId:`result-${Date.now()}`,severity:n[Math.floor(Math.random()*n.length)],vulnType:s[r],details:`在 ${new Date().toLocaleTimeString()} 检测到 ${s[r]} 漏洞`})};return(l,n)=>(u(),i("div",O,[e("div",U,[n[7]||(n[7]=e("h2",null,"创建新扫描任务",-1)),e("form",{onSubmit:N(x,["prevent"])},[e("label",null,[n[3]||(n[3]=p(" 任务名称: ")),f(e("input",{"onUpdate:modelValue":n[0]||(n[0]=s=>o.value.name=s),required:""},null,512),[[T,o.value.name]])]),e("label",null,[n[4]||(n[4]=p(" 扫描目标: ")),f(e("input",{"onUpdate:modelValue":n[1]||(n[1]=s=>o.value.target=s),placeholder:"https://example.com",required:""},null,512),[[T,o.value.target]])]),e("label",null,[n[5]||(n[5]=p(" 扫描命令: ")),f(e("input",{"onUpdate:modelValue":n[2]||(n[2]=s=>o.value.command=s),placeholder:"nmap -sV",required:""},null,512),[[T,o.value.command]])]),n[6]||(n[6]=e("button",{type:"submit"},"开始扫描",-1))],32)]),e("div",q,[e("h2",null,"任务列表 ("+d(c.value.length)+")",1),e("button",{onClick:$},"刷新任务列表"),e("div",P,[(u(),i(y,null,_(["all","pending","running","completed","failed"],s=>e("button",{key:s,onClick:r=>k.value=s,class:w({active:k.value===s})},d(s)+" ("+d(b.value[s])+") ",11,z)),64))]),g.value.length?(u(),i("ul",J,[(u(!0),i(y,null,_(g.value,s=>(u(),i("li",{key:s.id,class:w(s.status)},[e("div",G,[e("h3",null,d(s.name),1),e("span",Q,d(s.status),1),e("button",{onClick:r=>V(s.id)},"删除",8,X)]),e("p",null,[n[8]||(n[8]=e("strong",null,"目标:",-1)),p(" "+d(s.target),1)]),e("p",null,[n[9]||(n[9]=e("strong",null,"命令:",-1)),p(" "+d(s.command),1)]),e("p",null,[n[10]||(n[10]=e("strong",null,"开始时间:",-1)),p(" "+d(S(s.startTime)),1)]),e("div",H,[s.status==="pending"?(u(),i("button",{key:0,onClick:r=>D(s.id)},"开始扫描",8,K)):m("",!0),s.status==="running"?(u(),i("button",{key:1,onClick:r=>j(s.id)}," 模拟添加结果 ",8,W)):m("",!0),s.status==="running"?(u(),i("button",{key:2,onClick:r=>I(s.id)}," 标记完成 ",8,Y)):m("",!0),s.status!=="failed"?(u(),i("button",{key:3,onClick:r=>M(s.id)},"标记失败",8,Z)):m("",!0)]),s.results.length?(u(),i("div",tt,[e("h4",null,"扫描结果 ("+d(s.results.length)+")",1),(u(!0),i(y,null,_(s.results,(r,B)=>(u(),i("div",{key:r.resultId,class:w(["result-item",r.severity])},[e("p",null,[e("strong",null,"#"+d(B+1)+" "+d(r.vulnType),1)]),e("p",null,[n[11]||(n[11]=p(" 严重程度: ")),e("span",st,d(r.severity),1)]),e("p",null,d(r.details),1)],2))),128))])):m("",!0)],2))),128))])):(u(),i("p",et,"没有找到任务"))])]))}}),ot=R(nt,[["__scopeId","data-v-9607dc92"]]);export{ot as default};
