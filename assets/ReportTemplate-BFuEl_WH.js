import{_ as me,x as pe,y as ve,b as S,e as a,m as U,g as o,l as w,t as V,w as r,h as g,F as G,k as K,z as we,A as _e,r as y,a as ge,c as ke,o as ye,E as f,B as be,C as Q,j as b,n as X,f as Te}from"./index-DEvyraLu.js";import{p as Ce,m as Se}from"./purify.es-CsY-PwS5.js";const De={components:{UploadFilled:ve,Loading:pe},setup(){const p=y([]),e=y(!1),I=y(!1),n=y(null),v=y(null),T=y(null),d=y(!1),x=y("编辑报告模板"),u=ge({id:"",name:"",content:"",isDefault:!1,created:""}),_=ke(()=>Ce.sanitize(Se.parse(u.content||""))),E=y([{value:"summary",label:"扫描概述"},{value:"vulnerabilities",label:"漏洞清单"},{value:"recommendations",label:"修复建议"},{value:"risk_levels",label:"风险评级"},{value:"compliance",label:"合规检查"},{value:"executive_summary",label:"执行摘要"}]),D=y(""),F=y(null),C=(t,l="")=>{const s=F.value;if(!s)return;const c=s.selectionStart,m=s.selectionEnd,k=u.content,O=k.slice(c,m),W=t+O+l;u.content=k.slice(0,c)+W+k.slice(m),Q(()=>{s.focus(),s.selectionStart=c+t.length,s.selectionEnd=c+t.length+O.length})},N=t=>{const l=F.value;if(!l)return;const s=l.selectionStart,c=l.selectionEnd,m=u.content,k=m.slice(0,s),O=m.slice(s,c),W=m.slice(c),ue=O.split(`
`).map((q,fe)=>t(fe,q)+q);u.content=k+ue.join(`
`)+W},H=()=>C("**","**"),j=()=>C("_","_"),B=()=>C("<u>","</u>"),i=()=>N(()=>"- "),h=()=>N(t=>`${t+1}. `),Y=()=>{const t=window.prompt("请输入链接 URL");if(!t)return;const l=window.prompt("显示文本（可留空使用 URL）")||t;C(`[${l}](${t})`)},Z=()=>{const t=window.prompt("请输入图片 URL");if(!t)return;const l=window.prompt("图片替代文字（alt）")||"";C(`![${l}](${t})`)},$={summary:`## 扫描概述

- 扫描类型: 
- 扫描范围: 
- 时间范围: 
`,vulnerabilities:`## 漏洞清单

| ID | 风险 | 描述 |
| --- | --- | --- |
| VUL-001 | 高 | 示例描述 |
`,recommendations:`## 修复建议

1. 建议一
2. 建议二
`,risk_levels:`## 风险评级

| 等级 | 说明 |
| --- | --- |
| 高 | 立即处理 |
`,compliance:`## 合规检查

- 标准: 
- 结果: 
`,executive_summary:`## 执行摘要

> 用一句话总结关键风险。
`},ee=()=>{if(!D.value){f.warning("请选择区块类型");return}const t=$[D.value];C(`
`+t+`
`),D.value=""},te=async()=>{try{const t=await window.showDirectoryPicker({id:"scanTemplateFolder",mode:"readwrite"});await L(t,!0)&&(v.value=t,localStorage.setItem("lastTemplateFolderHandle",JSON.stringify({name:t.name})),A())}catch(t){console.error("选择文件夹失败:",t),f.error(`选择文件夹失败: ${t.message||"用户取消操作"}`)}},L=async(t,l)=>{const s={};return s.mode="readwrite",await t.queryPermission(s)==="granted"||await t.requestPermission(s)==="granted"},A=async()=>{if(v.value){e.value=!0,p.value=[],T.value=null;try{let t;try{t=await v.value.getFileHandle("default.json",{create:!0})}catch(l){console.error("获取默认模板文件失败:",l)}if(t){const l=await P(t);if(l)try{const s=JSON.parse(l);T.value=s.defaultTemplateId}catch(s){console.warn("解析默认模板文件失败:",s)}}for await(const l of v.value.values())if(l.kind==="file"&&l.name.startsWith("tpl-")&&l.name.endsWith(".json"))try{const c=await P(l);if(c)try{const m=JSON.parse(c),k=l.name.replace("tpl-","").replace(".json","");m.id=k,m.isDefault=k===T.value,p.value.push(m)}catch(m){console.error(`解析模板文件 ${l.name} 失败:`,m)}}catch(s){console.error(`读取模板文件 ${l.name} 失败:`,s)}p.value.sort((l,s)=>new Date(s.created).getTime()-new Date(l.created).getTime()),f.success(`已加载 ${p.value.length} 个模板`)}catch(t){console.error("加载模板失败:",t),f.error(`加载模板失败: ${t.message}`)}finally{e.value=!1}}},P=async t=>{try{return await(await t.getFile()).text()}catch(l){return console.error("读取文件失败:",l),f.error(`读取文件失败: ${l.message}`),null}},R=async t=>{if(!v.value)return f.warning("请先选择模板文件夹"),!1;try{const s=`tpl-${t.id.replace("tpl-","")}.json`,c=await v.value.getFileHandle(s,{create:!0});if(!await L(c,!0))return f.error("没有文件写入权限"),!1;const m=await c.createWritable();return await m.write(JSON.stringify(t,null,2)),await m.close(),!0}catch(l){return console.error("保存模板失败:",l),f.error(`保存模板失败: ${l.message}`),!1}},z=async t=>{if(v.value)try{const l=await v.value.getFileHandle("default.json",{create:!0});if(!await L(l,!0))return!1;const s=await l.createWritable();return await s.write(JSON.stringify({defaultTemplateId:t},null,2)),await s.close(),T.value=t,!0}catch(l){return console.error("设置默认模板失败:",l),f.error(`设置默认模板失败: ${l.message}`),!1}},le=async t=>{if(!v.value)return!1;try{const l=`tpl-${t.id}.json`;let s;try{s=await v.value.getFileHandle(l)}catch{return!0}return v.value.removeEntry?(await v.value.removeEntry(l),!0):(f.error("您的浏览器不支持文件删除操作"),!1)}catch(l){return console.error("删除模板文件失败:",l),f.error(`删除模板文件失败: ${l.message}`),!1}},ae=()=>{if(!v.value){f.warning("请先选择模板文件夹");return}x.value="创建新模板",re(),d.value=!0},ne=t=>{const l={...t,id:t.id.replace("tpl-","")};x.value="编辑模板",Object.assign(u,l),d.value=!0,Q(()=>{var s;return(s=F.value)==null?void 0:s.focus()})},se=async()=>{u.id||(u.id=Date.now().toString(),u.created=new Date().toISOString()),u.preview=M(u.name);try{if(await R(u)){u.isDefault&&await J(u);const l=p.value.findIndex(s=>s.id===u.id);l!==-1?p.value[l]={...u}:p.value.push({...u}),f.success("模板保存成功"),d.value=!1}}catch(t){console.error("保存模板过程中出错:",t),f.error("模板保存失败")}},J=async t=>{try{await z(t.id)&&(p.value.forEach(s=>{s.isDefault=s.id===t.id}),f.success(`已将 "${t.name}" 设为默认模板`))}catch(l){console.error("设置默认模板过程中出错:",l),f.error("设置默认模板失败")}},oe=async t=>{try{be.confirm(`确定要删除模板 "${t.name}" 吗？此操作无法撤销。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await le(t)&&(t.isDefault&&(await z(null),T.value=null),p.value=p.value.filter(s=>s.id!==t.id),t.isDefault&&p.value.length>0&&await J(p.value[0]),f.success("模板删除成功"))}).catch(()=>{})}catch(l){console.error("删除模板过程中出错:",l),f.error("模板删除失败")}},re=()=>{const t=Date.now().toString().slice(-5);Object.assign(u,{id:t,name:"未命名模板",content:`# 报告标题

## 章节标题
...`,isDefault:!1,created:new Date().toISOString(),preview:M("未命名模板")})},M=t=>`
        <div class="template-preview-content">
          <h3>${t}</h3>
          <div class="preview-stats">
            <span class="stat-item"><i class="fas fa-bug"></i> 漏洞: 0</span>
            <span class="stat-item"><i class="fas fa-chart-pie"></i> 风险评级: 中</span>
          </div>
          <div class="preview-sections">
            <p>扫描概述 | 漏洞列表 | 修复建议 | 合规检查</p>
          </div>
        </div>
      `,ie=()=>{I.value=!0},ce=t=>{n.value=t.raw;const l=new FileReader;l.onload=async s=>{try{const c=JSON.parse(s.target.result);if(!c.id||!c.name||!c.content)throw new Error("无效的模板格式");c.preview=M(c.name),await R(c)&&(p.value.push(c),f.success(`模板 "${c.name}" 导入成功`),I.value=!1)}catch(c){console.error("导入模板失败:",c),f.error(`导入失败: ${c.message||"文件格式无效"}`)}},l.readAsText(n.value)},de=async()=>{if(p.value.length===0){f.warning("没有模板可导出");return}try{const t=await window.showDirectoryPicker({mode:"readwrite",suggestedName:"扫描报告模板"});if(await L(t,!0)){const l=`模板导出-${new Date().toISOString().slice(0,10)}`,s=await t.getDirectoryHandle(l,{create:!0});for(const c of p.value){const k=await(await s.getFileHandle(`tpl-${c.id}.json`,{create:!0})).createWritable();await k.write(JSON.stringify(c,null,2)),await k.close()}if(T.value){const m=await(await s.getFileHandle("default.json",{create:!0})).createWritable();await m.write(JSON.stringify({defaultTemplateId:T.value})),await m.close()}f.success(`已导出 ${p.value.length} 个模板到文件夹 "${l}"`)}}catch(t){console.error("导出模板失败:",t),f.error(`导出失败: ${t.message||"用户取消操作"}`)}};return ye(()=>{const t=localStorage.getItem("lastTemplateFolderHandle");if(t)try{const l=JSON.parse(t);document.querySelector(".action-button.folder").click()}catch(l){console.error("解析上次文件夹失败:",l)}}),{templates:p,editorVisible:d,editorTitle:x,currentTemplate:u,sections:E,selectedSection:D,renderedContent:_,markdownTextarea:F,loading:e,importDialogVisible:I,currentFolder:v,makeBold:H,makeItalic:j,makeUnderline:B,makeUnorderedList:i,makeOrderedList:h,insertLink:Y,insertImage:Z,insertSection:ee,createNewTemplate:ae,editTemplate:ne,saveTemplate:se,setAsDefault:J,deleteTemplate:oe,importTemplate:ie,exportAllTemplates:de,handleImportFile:ce,selectTemplateFolder:te,loadTemplates:A}}},Fe={class:"report-template-view"},xe={class:"header-section"},Ve={key:0,class:"folder-info"},Ie={class:"action-section"},Ne={key:0,class:"loading-section"},He={class:"template-list"},he={class:"card-header"},Le={class:"template-meta"},Oe={class:"template-name"},Ue={key:0,class:"default-badge"},Ee={class:"template-actions"},je={class:"template-preview"},Be=["innerHTML"],Je={class:"card-footer"},Me={class:"footer-info"},We={class:"create-date"},Ae={class:"template-id"},Pe={key:0,class:"empty-templates"},Re={class:"template-editor-container"},ze={class:"editor-header"},qe={class:"default-switch"},Ge={class:"editor-toolbar"},Ke={class:"toolbar-left"},Qe={class:"toolbar-right"},Xe={class:"editor-content"},Ye={class:"editor-pane"},Ze={class:"preview-pane"},$e={class:"preview-header"},et=["innerHTML"],tt={class:"dialog-footer"},lt={class:"import-dialog"};function at(p,e,I,n,v,T){const d=g("el-button"),x=g("loading"),u=g("el-icon"),_=g("el-tooltip"),E=g("el-input"),D=g("el-switch"),F=g("el-option"),C=g("el-select"),N=g("View"),H=g("el-dialog"),j=g("upload-filled"),B=g("el-upload");return b(),S("div",Fe,[a("div",xe,[e[9]||(e[9]=a("div",{class:"header-content"},[a("div",{class:"title-container"},[a("h1",null,"报告模板管理")]),a("p",{class:"subtitle"},"创建、编辑和管理您的安全扫描报告模板")],-1)),n.currentFolder?(b(),S("div",Ve,[e[8]||(e[8]=a("i",{class:"fas fa-folder"},null,-1)),w(" "+V(n.currentFolder.name),1)])):U("",!0)]),a("div",Ie,[o(d,{type:"primary",class:"action-button",onClick:n.createNewTemplate},{default:r(()=>e[10]||(e[10]=[a("i",{class:"fas fa-plus"},null,-1),w(" 创建新模板 ")])),_:1,__:[10]},8,["onClick"]),o(d,{class:"action-button secondary",onClick:n.importTemplate},{default:r(()=>e[11]||(e[11]=[a("i",{class:"fas fa-file-import"},null,-1),w(" 导入模板 ")])),_:1,__:[11]},8,["onClick"]),o(d,{class:"action-button tertiary",onClick:n.exportAllTemplates},{default:r(()=>e[12]||(e[12]=[a("i",{class:"fas fa-file-export"},null,-1),w(" 批量导出 ")])),_:1,__:[12]},8,["onClick"]),o(d,{class:"action-button folder",type:"info",onClick:n.selectTemplateFolder},{default:r(()=>[e[13]||(e[13]=a("i",{class:"fas fa-folder-open"},null,-1)),w(" "+V(n.currentFolder?"切换文件夹":"选择模板文件夹"),1)]),_:1,__:[13]},8,["onClick"]),o(d,{class:"action-button",type:"success",onClick:n.loadTemplates,disabled:!n.currentFolder},{default:r(()=>e[14]||(e[14]=[a("i",{class:"fas fa-sync-alt"},null,-1),w(" 重新加载模板 ")])),_:1,__:[14]},8,["onClick","disabled"])]),n.loading?(b(),S("div",Ne,[o(u,{class:"is-loading"},{default:r(()=>[o(x)]),_:1}),e[15]||(e[15]=a("span",null,"加载模板中...",-1))])):U("",!0),a("div",He,[(b(!0),S(G,null,K(n.templates,i=>(b(),S("div",{class:X(["template-card",{"default-template":i.isDefault}]),key:i.id},[a("div",he,[a("div",Le,[a("span",Oe,V(i.name),1),i.isDefault?(b(),S("span",Ue,e[16]||(e[16]=[a("i",{class:"fas fa-star"},null,-1),w(" 默认模板 ")]))):U("",!0)]),a("div",Ee,[o(_,{effect:"dark",content:"编辑模板",placement:"top"},{default:r(()=>[o(d,{circle:"",class:"action-edit",onClick:h=>n.editTemplate(i)},{default:r(()=>e[17]||(e[17]=[a("i",{class:"fas fa-edit"},null,-1)])),_:2,__:[17]},1032,["onClick"])]),_:2},1024),o(_,{effect:"dark",content:i.isDefault?"已是默认模板":"设为默认模板",placement:"top"},{default:r(()=>[o(d,{circle:"",class:"action-default",type:i.isDefault?"success":"",onClick:h=>n.setAsDefault(i)},{default:r(()=>[a("i",{class:X(["fas",i.isDefault?"fa-check":"fa-star"])},null,2)]),_:2},1032,["type","onClick"])]),_:2},1032,["content"]),o(_,{effect:"dark",content:"删除模板",placement:"top"},{default:r(()=>[o(d,{circle:"",class:"action-delete",type:"danger",onClick:h=>n.deleteTemplate(i)},{default:r(()=>e[18]||(e[18]=[a("i",{class:"fas fa-trash"},null,-1)])),_:2,__:[18]},1032,["onClick"])]),_:2},1024)])]),a("div",je,[a("div",{class:"preview-content",innerHTML:i.preview},null,8,Be)]),a("div",Je,[a("div",Me,[a("span",We,[e[19]||(e[19]=a("i",{class:"fas fa-calendar-alt"},null,-1)),w(" 创建于: "+V(i.created),1)]),a("span",Ae,[e[20]||(e[20]=a("i",{class:"fas fa-fingerprint"},null,-1)),w(" ID: "+V(i.id),1)])])])],2))),128)),a("div",{class:"template-card add-new",onClick:e[0]||(e[0]=(...i)=>n.createNewTemplate&&n.createNewTemplate(...i))},e[21]||(e[21]=[a("div",{class:"add-new-content"},[a("i",{class:"fas fa-plus-circle"}),a("span",null,"添加新模板")],-1)])),n.templates.length===0&&!n.loading?(b(),S("div",Pe,[e[23]||(e[23]=a("i",{class:"fas fa-file-alt"},null,-1)),e[24]||(e[24]=a("h3",null,"没有找到模板",-1)),e[25]||(e[25]=a("p",null,"请创建新模板或导入现有模板",-1)),o(d,{type:"primary",onClick:n.createNewTemplate},{default:r(()=>e[22]||(e[22]=[w("创建新模板")])),_:1,__:[22]},8,["onClick"])])):U("",!0)]),o(H,{modelValue:n.editorVisible,"onUpdate:modelValue":e[6]||(e[6]=i=>n.editorVisible=i),title:n.editorTitle,width:"80%","custom-class":"template-editor-dialog"},{footer:r(()=>[a("div",tt,[o(d,{onClick:e[5]||(e[5]=i=>n.editorVisible=!1)},{default:r(()=>e[36]||(e[36]=[w("取消")])),_:1,__:[36]}),o(d,{type:"primary",onClick:n.saveTemplate},{default:r(()=>e[37]||(e[37]=[w("保存模板")])),_:1,__:[37]},8,["onClick"])])]),default:r(()=>[a("div",Re,[a("div",ze,[o(E,{modelValue:n.currentTemplate.name,"onUpdate:modelValue":e[1]||(e[1]=i=>n.currentTemplate.name=i),placeholder:"输入模板名称",clearable:"",class:"template-name-input"},null,8,["modelValue"]),a("div",qe,[e[26]||(e[26]=a("span",{class:"switch-label"},"设为默认模板：",-1)),o(D,{modelValue:n.currentTemplate.isDefault,"onUpdate:modelValue":e[2]||(e[2]=i=>n.currentTemplate.isDefault=i)},null,8,["modelValue"])])]),a("div",Ge,[a("div",Ke,[o(_,{effect:"dark",content:"加粗 (Ctrl+B)",placement:"top"},{default:r(()=>[o(d,{circle:"",class:"toolbar-btn toolbar-bold",onClick:n.makeBold},{default:r(()=>e[27]||(e[27]=[a("i",{class:"fas fa-bold"},null,-1)])),_:1,__:[27]},8,["onClick"])]),_:1}),o(_,{effect:"dark",content:"斜体 (Ctrl+I)",placement:"top"},{default:r(()=>[o(d,{circle:"",class:"toolbar-btn toolbar-italic",onClick:n.makeItalic},{default:r(()=>e[28]||(e[28]=[a("i",{class:"fas fa-italic"},null,-1)])),_:1,__:[28]},8,["onClick"])]),_:1}),o(_,{effect:"dark",content:"下划线",placement:"top"},{default:r(()=>[o(d,{circle:"",class:"toolbar-btn toolbar-underline",onClick:n.makeUnderline},{default:r(()=>e[29]||(e[29]=[a("i",{class:"fas fa-underline"},null,-1)])),_:1,__:[29]},8,["onClick"])]),_:1}),o(_,{effect:"dark",content:"无序列表",placement:"top"},{default:r(()=>[o(d,{circle:"",class:"toolbar-btn toolbar-ul",onClick:n.makeUnorderedList},{default:r(()=>e[30]||(e[30]=[a("i",{class:"fas fa-list-ul"},null,-1)])),_:1,__:[30]},8,["onClick"])]),_:1}),o(_,{effect:"dark",content:"有序列表",placement:"top"},{default:r(()=>[o(d,{circle:"",class:"toolbar-btn toolbar-ol",onClick:n.makeOrderedList},{default:r(()=>e[31]||(e[31]=[a("i",{class:"fas fa-list-ol"},null,-1)])),_:1,__:[31]},8,["onClick"])]),_:1}),o(_,{effect:"dark",content:"插入链接",placement:"top"},{default:r(()=>[o(d,{circle:"",class:"toolbar-btn toolbar-link",onClick:n.insertLink},{default:r(()=>e[32]||(e[32]=[a("i",{class:"fas fa-link"},null,-1)])),_:1,__:[32]},8,["onClick"])]),_:1}),o(_,{effect:"dark",content:"插入图片",placement:"top"},{default:r(()=>[o(d,{circle:"",class:"toolbar-btn toolbar-image",onClick:n.insertImage},{default:r(()=>e[33]||(e[33]=[a("i",{class:"fas fa-image"},null,-1)])),_:1,__:[33]},8,["onClick"])]),_:1})]),a("div",Qe,[o(C,{modelValue:n.selectedSection,"onUpdate:modelValue":e[3]||(e[3]=i=>n.selectedSection=i),placeholder:"插入区块"},{default:r(()=>[(b(!0),S(G,null,K(n.sections,i=>(b(),Te(F,{key:i.value,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(d,{type:"primary",onClick:n.insertSection},{default:r(()=>e[34]||(e[34]=[w("插入")])),_:1,__:[34]},8,["onClick"])])]),a("div",Xe,[a("div",Ye,[we(a("textarea",{ref:"markdownTextarea","onUpdate:modelValue":e[4]||(e[4]=i=>n.currentTemplate.content=i),class:"markdown-editor",spellcheck:"false",placeholder:"输入Markdown格式的模板内容..."},null,512),[[_e,n.currentTemplate.content]])]),a("div",Ze,[a("div",$e,[o(u,null,{default:r(()=>[o(N)]),_:1}),e[35]||(e[35]=a("h4",null,"实时预览",-1))]),a("div",{class:"preview-content",innerHTML:n.renderedContent},null,8,et)])])])]),_:1},8,["modelValue","title"]),o(H,{modelValue:n.importDialogVisible,"onUpdate:modelValue":e[7]||(e[7]=i=>n.importDialogVisible=i),title:"导入模板",width:"500px"},{default:r(()=>[a("div",lt,[e[40]||(e[40]=a("p",null,"请选择要导入的模板文件：",-1)),o(B,{class:"import-upload",drag:"","auto-upload":!1,"show-file-list":!0,"on-change":n.handleImportFile,accept:".json"},{tip:r(()=>e[38]||(e[38]=[a("div",{class:"el-upload__tip"},"仅支持JSON格式文件",-1)])),default:r(()=>[o(u,{class:"el-icon--upload"},{default:r(()=>[o(j)]),_:1}),e[39]||(e[39]=a("div",{class:"el-upload__text"},[w(" 拖放文件到此处或 "),a("em",null,"点击选择文件")],-1))]),_:1,__:[39]},8,["on-change"])])]),_:1},8,["modelValue"])])}const rt=me(De,[["render",at],["__scopeId","data-v-d37eb4e1"]]);export{rt as default};
