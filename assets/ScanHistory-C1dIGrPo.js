import{d as $,u as E,r as D,o as F,a as z,c as I,b as r,e as t,f as y,g as l,w as o,h as u,E as S,i as j,j as a,F as P,k as W,l as h,t as m,m as c,n as q,_ as A}from"./index-mgR_4hwW.js";const G={class:"scan-history-view"},J={class:"filter-card"},K={class:"filter-item"},O={class:"filter-item"},Q={class:"filter-item"},X={class:"scanner-header"},Z={class:"name"},w={class:"date-info"},ee={class:"date"},te={key:0,class:"info-item pending"},se={key:1,class:"info-item running"},le={key:2,class:"info-item completed"},ae={key:3,class:"info-item failed"},ne={class:"card-body"},oe={class:"target-info"},ie={class:"target"},de={class:"vuln-summary"},re={key:0,class:"vuln-item critical"},ue={class:"vuln-count"},ce={key:1,class:"vuln-item high"},me={class:"vuln-count"},pe={key:2,class:"vuln-item medium"},_e={class:"vuln-count"},ve={key:3,class:"vuln-item low"},fe={class:"vuln-count"},ge={key:4,class:"vuln-item safe"},ye={class:"card-footer action-buttons"},he=$({__name:"ScanHistory",setup(be){const b=E(),T=j(),f=D([]),k=D(!0),R=async()=>{await b.fetchTasks()},H=async()=>{k.value=!0;try{await R(),f.value=b.getScanHistory().slice().reverse(),f.value.length===0?S.info("暂无扫描历史记录"):console.log("获取的扫描历史数量:",f.value.length)}catch(d){S.error("加载扫描历史失败，请稍后重试"),console.error("加载扫描历史失败:",d)}finally{k.value=!1}};F(()=>{H()});const i=z({target:"",dateRange:[],status:""}),V=I(()=>{const d=f.value??[],e=i.dateRange??[];return d.filter(_=>{const v=i.target?_.target.toLowerCase().includes(i.target.toLowerCase()):!0,g=e.length===2?new Date(_.startTime)>=new Date(e[0])&&new Date(_.startTime)<=new Date(e[1]):!0,p=i.status?_.status===i.status:!0;return v&&g&&p})}),n=d=>({critical:d.results.filter(e=>e.severity==="critical").length,high:d.results.filter(e=>e.severity==="high").length,medium:d.results.filter(e=>e.severity==="medium").length,low:d.results.filter(e=>e.severity==="low").length}),B=d=>{T.push("/scan-history/"+d.id)};return(d,e)=>{const _=u("el-input"),v=u("el-col"),g=u("el-date-picker"),p=u("el-option"),L=u("el-select"),x=u("el-row"),M=u("el-tag"),N=u("el-button"),U=u("el-card"),Y=u("el-empty");return a(),r("div",G,[e[18]||(e[18]=t("div",{class:"header-section"},[t("div",{class:"header-content"},[t("div",{class:"title-container"},[t("h1",null,"扫描历史记录")]),t("p",{class:"subtitle"},"查看和管理扫描历史记录，分析漏洞技术细节")])],-1)),t("div",J,[l(x,{gutter:20},{default:o(()=>[l(v,{xs:24,sm:12,md:8},{default:o(()=>[t("div",K,[e[4]||(e[4]=t("label",{class:"filter-label"},"扫描目标",-1)),l(_,{modelValue:i.target,"onUpdate:modelValue":e[0]||(e[0]=s=>i.target=s),placeholder:"输入URL或关键词",class:"filter-input"},{prefix:o(()=>e[3]||(e[3]=[t("i",{class:"fas fa-bullseye"},null,-1)])),_:1},8,["modelValue"])])]),_:1}),l(v,{xs:24,sm:12,md:8},{default:o(()=>[t("div",O,[e[6]||(e[6]=t("label",{class:"filter-label"},"日期范围",-1)),l(g,{modelValue:i.dateRange,"onUpdate:modelValue":e[1]||(e[1]=s=>i.dateRange=s),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",class:"filter-date-picker"},{prefix:o(()=>e[5]||(e[5]=[t("i",{class:"fas fa-calendar"},null,-1)])),_:1},8,["modelValue"])])]),_:1}),l(v,{xs:24,sm:12,md:8},{default:o(()=>[t("div",Q,[e[7]||(e[7]=t("label",{class:"filter-label"},"状态",-1)),l(L,{modelValue:i.status,"onUpdate:modelValue":e[2]||(e[2]=s=>i.status=s),placeholder:"选择状态",class:"filter-select"},{default:o(()=>[l(p,{label:"全部",value:""}),l(p,{label:"挂起",value:"pending"}),l(p,{label:"执行",value:"running"}),l(p,{label:"完成",value:"completed"}),l(p,{label:"失败",value:"failed"})]),_:1},8,["modelValue"])])]),_:1})]),_:1})]),V.value.length>0?(a(),y(x,{key:0,gutter:20,class:"scan-history-cards"},{default:o(()=>[(a(!0),r(P,null,W(V.value,(s,C)=>(a(),y(v,{key:C,xs:24,sm:24,md:12,lg:12,xl:8},{default:o(()=>[l(U,{class:"scan-history-card",shadow:"hover"},{default:o(()=>[t("div",X,[t("div",Z,[h(m(s.name||`扫描记录 ${C+1}`)+" ",1),l(M,{type:/^(?:\d{1,3}\.){3}\d{1,3}$/.test(s.target)?"warning":"primary",class:"scan-type-tag",effect:"plain"},{default:o(()=>[h(m(/^(?:\d{1,3}\.){3}\d{1,3}$/.test(s.target)?"IP扫描":"Web扫描"),1)]),_:2},1032,["type"])]),t("div",w,[t("div",ee,m(s.startTime),1),s.status=="pending"?(a(),r("div",te,e[8]||(e[8]=[t("p",null,"挂起",-1)]))):c("",!0),s.status=="running"?(a(),r("div",se,e[9]||(e[9]=[t("p",null,"执行",-1)]))):c("",!0),s.status=="completed"?(a(),r("div",le,e[10]||(e[10]=[t("p",null,"完成",-1)]))):c("",!0),s.status=="failed"?(a(),r("div",ae,e[11]||(e[11]=[t("p",null,"失败",-1)]))):c("",!0)])]),t("div",ne,[t("div",oe,[t("i",{class:q(["fas",s.type==="web"?"fa-globe":"fa-file-code"])},null,2),t("span",ie,m(s.target),1)]),t("div",de,[n(s).critical>0?(a(),r("div",re,[e[12]||(e[12]=t("span",{class:"vuln-label"},"严重",-1)),t("span",ue,m(n(s).critical),1)])):c("",!0),n(s).high>0?(a(),r("div",ce,[e[13]||(e[13]=t("span",{class:"vuln-label"},"高危",-1)),t("span",me,m(n(s).high),1)])):c("",!0),n(s).medium>0?(a(),r("div",pe,[e[14]||(e[14]=t("span",{class:"vuln-label"},"中危",-1)),t("span",_e,m(n(s).medium),1)])):c("",!0),n(s).low>0?(a(),r("div",ve,[e[15]||(e[15]=t("span",{class:"vuln-label"},"低危",-1)),t("span",fe,m(n(s).low),1)])):c("",!0),n(s).low===0&&n(s).medium===0&&n(s).high===0&&n(s).critical===0?(a(),r("div",ge,e[16]||(e[16]=[t("span",{class:"vuln-label"},"无风险",-1)]))):c("",!0)])]),t("div",ye,[l(N,{type:"primary",onClick:ke=>B(s),class:"gobutton"},{default:o(()=>e[17]||(e[17]=[t("i",{class:"fas fa-search"},null,-1),h(" 查看详情 ")])),_:2,__:[17]},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(a(),y(Y,{key:1,description:"暂无扫描记录","image-size":"160",class:"empty-placeholder"}))])}}}),xe=A(he,[["__scopeId","data-v-2beeaa6b"]]);export{xe as default};
